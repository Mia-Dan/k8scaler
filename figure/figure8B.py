import csv
import numpy
from scipy.interpolate import make_interp_spline
from matplotlib import pyplot as plt

plt.rc('font', family='Times New Roman')
plt.figure(figsize=(8, 5))

time0 = [7.14, 14.28, 21.42, 28.56, 35.7, 42.84, 49.98, 57.12, 64.26, 71.4, 78.54, 85.68, 92.82, 99.96, 107.1, 114.24,
         121.38, 128.52, 135.66, 142.8, 149.94, 157.08, 164.22, 171.36, 178.5, 185.64, 192.78, 199.92, 207.06, 214.2,
         221.34, 228.48, 235.62, 242.76, 249.9, 257.04, 264.18, 271.32, 278.46, 285.6, 292.74, 299.88, 307.02, 314.16,
         321.3, 328.44, 335.58, 342.72, 349.86, 357, 364.14, 371.28, 378.42, 385.56, 392.7, 399.84, 406.98, 414.12,
         421.26, 428.4, 435.54, 442.68, 449.82, 456.96, 464.1, 471.24, 478.38, 485.52, 492.66, 499.8, 506.94, 514.08,
         521.22, 528.36, 535.5, 542.64, 549.78, 556.92, 564.06, 571.2, 578.34, 585.48, 592.62, 599.76, 606.9, 614.04,
         621.18, 628.32, 635.46, 642.6, 649.74, 656.88, 664.02, 671.16, 678.3, 685.44, 692.58, 699.72, 706.86, 714,
         721.14, 728.28, 735.42, 742.56, 749.7, 756.84, 763.98, 771.12, 778.26, 785.4, 792.54, 799.68, 806.82, 813.96,
         821.1, 828.24, 835.38, 842.52, 849.66, 856.8, 863.94, 871.08, 878.22, 885.36, 892.5, 899.64, 906.78, 913.92,
         921.06, 928.2, 935.34, 942.48, 949.62, 956.76, 963.9, 971.04, 978.18, 985.32, 992.46, 999.6, 1006.74, 1013.88,
         1021.02, 1028.16, 1035.3, 1042.44, 1049.58, 1056.72, 1063.86, 1071, 1078.14, 1085.28, 1092.42, 1099.56, 1106.7,
         1113.84, 1120.98, 1128.12, 1135.26, 1142.4, 1149.54, 1156.68, 1163.82, 1170.96, 1178.1, 1185.24, 1192.38,
         1199.52, 1206.66, 1213.8, 1220.94, 1228.08, 1235.22, 1242.36, 1249.5, 1256.64, 1263.78, 1270.92, 1278.06,
         1285.2, 1292.34, 1299.48, 1306.62, 1313.76, 1320.9, 1328.04, 1335.18, 1342.32, 1349.46, 1356.6, 1363.74,
         1370.88, 1378.02, 1385.16, 1392.3, 1399.44, 1406.58, 1413.72, 1420.86, 1428, 1435.14, 1442.28, 1449.42,
         1456.56, 1463.7, 1470.84, 1477.98, 1485.12, 1492.26, 1499.4]
cpu0 = [4.333333333, 4.333333333, 4.333333333, 4.333333333, 4.666666667, 4.333333333, 4, 6.666666667, 7.333333333,
        7.333333333, 7.666666667, 7, 8, 6.333333333, 7, 10, 10.66666667, 10.33333333, 9.666666667, 10.33333333,
        11.33333333, 10.66666667, 13.33333333, 13.33333333, 14, 13.66666667, 14, 14, 14.33333333, 14, 14.66666667,
        16.66666667, 16.66666667, 17.33333333, 16.66666667, 16, 16.66666667, 16.66666667, 20.66666667, 21, 21, 21,
        21.33333333, 19.66666667, 20, 22, 24.66666667, 24.33333333, 21.33333333, 24, 24.66666667, 25, 25, 24.33333333,
        27, 27.33333333, 27.66666667, 27.66666667, 26, 25.33333333, 31, 30.66666667, 30, 29.33333333, 31.33333333,
        29.66666667, 29.66666667, 26.33333333, 36, 32, 33.66666667, 33.66666667, 32.33333333, 34.66666667, 29.66666667,
        37.33333333, 37.33333333, 38.33333333, 36, 37.33333333, 37.33333333, 38, 32.66666667, 35.66666667, 39, 40,
        40.33333333, 39.33333333, 41, 42.66666667, 44.33333333, 43.66666667, 43.66666667, 42.66666667, 42.66666667,
        43.66666667, 40.66666667, 45, 47.66666667, 47, 44.33333333, 45.33333333, 46.66666667, 37.33333333, 51.33333333,
        47.66666667, 47.66666667, 49.66666667, 47.33333333, 52.66666667, 39.33333333, 43.66666667, 51, 52, 52, 52,
        46.66666667, 51.66666667, 49.33333333, 52.66666667, 56, 58, 58, 51, 51, 49, 49, 57.66666667, 58.66666667, 55,
        57.66666667, 60, 60, 56.66666667, 52.66666667, 57.66666667, 57.66666667, 56, 56, 56.66666667, 60.66666667,
        59.33333333, 57.33333333, 61.33333333, 58.33333333, 55.66666667, 61.66666667, 64.33333333, 62, 63.33333333,
        60.66666667, 66.66666667, 66.66666667, 55.33333333, 66, 68.33333333, 67.33333333, 67.33333333, 68.33333333, 64,
        69, 69, 68, 68, 71.33333333, 73.66666667, 74, 74, 73, 70, 67.66666667, 74.66666667, 69, 66.33333333, 74, 68,
        69.33333333, 69.33333333, 70, 72.33333333, 81, 73.66666667, 78, 74.33333333, 69.33333333, 80.66666667,
        72.66666667, 75, 72.66666667, 69.33333333, 69.33333333, 77.33333333, 72, 72.66666667, 66.33333333, 72, 72,
        66.33333333, 71.33333333, 69.33333333, 66.66666667, 69.33333333, 72.33333333, 71, 74, 81.33333333, 76.66666667,
        69, 69, 71.33333333]
[A, x, b] = numpy.polyfit(time0, cpu0, deg=2)
c = numpy.arange(0, 1495)
y = A * (c ** 2) + c * x + b
plt.plot(c, y, label="Fitted")
x0 = numpy.linspace(time0[0], time0[-1], 40000)
times = numpy.array(time0)
cpus = numpy.array(cpu0)
model = make_interp_spline(times, cpus)
y0 = model(x0)
plt.plot(x0, y0, '-.', label="Collected", linewidth=1)
plt.rcParams.update({'font.size': 14})
plt.legend(loc=2)
plt.xlabel("Load (QPS)", size=20)
plt.ylabel("CPU Utilization (%)", size=20)
plt.tick_params(labelsize=14)
plt.savefig('3B.png', dpi=100, bbox_inches='tight')
