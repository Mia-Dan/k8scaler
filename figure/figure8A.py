import numpy
from scipy.interpolate import make_interp_spline
from matplotlib import pyplot as plt

plt.rc('font', family='Times New Roman')
plt.figure(figsize=(8, 5))

time0 = [0, 7.35, 14.7, 22.05, 29.4, 36.75, 44.1, 51.45, 58.8, 66.15, 73.5, 80.85, 88.2, 95.55, 102.9, 110.25, 117.6,
         124.95, 132.3, 139.65, 147, 154.35, 161.7, 169.05, 176.4, 183.75, 191.1, 198.45, 205.8, 213.15, 220.5, 227.85,
         235.2, 242.55, 249.9, 257.25, 264.6, 271.95, 279.3, 286.65, 294, 301.35, 308.7, 316.05, 323.4, 330.75, 338.1,
         345.45, 352.8, 360.15, 367.5, 374.85, 382.2, 389.55, 396.9, 404.25, 411.6, 418.95, 426.3, 433.65, 441, 448.35,
         455.7, 463.05, 470.4, 477.75, 485.1, 492.45, 499.8, 507.15, 514.5, 521.85, 529.2, 536.55, 543.9, 551.25, 558.6,
         565.95, 573.3, 580.65, 588, 595.35, 602.7, 610.05, 617.4, 624.75, 632.1, 639.45, 646.8, 654.15, 661.5, 668.85,
         676.2, 683.55, 690.9, 698.25, 705.6, 712.95, 720.3, 727.65, 735, 742.35, 749.7, 757.05, 764.4, 771.75, 779.1,
         786.45, 793.8, 801.15, 808.5, 815.85, 823.2, 830.55, 837.9, 845.25, 852.6, 859.95, 867.3, 874.65, 882, 889.35,
         896.7, 904.05, 911.4, 918.75, 926.1, 933.45, 940.8, 948.15, 955.5, 962.85, 970.2, 977.55, 984.9, 992.25, 999.6,
         1006.95, 1014.3, 1021.65, 1029, 1036.35, 1043.7, 1051.05, 1058.4, 1065.75, 1073.1, 1080.45, 1087.8, 1095.15,
         1102.5, 1109.85, 1117.2, 1124.55, 1131.9, 1139.25, 1146.6, 1153.95, 1161.3, 1168.65, 1176, 1183.35, 1190.7,
         1198.05, 1205.4, 1212.75, 1220.1, 1227.45, 1234.8, 1242.15, 1249.5, 1256.85, 1264.2, 1271.55, 1278.9, 1286.25,
         1293.6, 1300.95, 1308.3, 1315.65, 1323, 1330.35, 1337.7, 1345.05, 1352.4, 1359.75, 1367.1, 1374.45, 1381.8,
         1389.15, 1396.5, 1403.85, 1411.2, 1418.55, 1425.9, 1433.25, 1440.6, 1447.95, 1455.3, 1462.65, 1470, 1477.35,
         1484.7, 1492.05]
cpu0 = [18, 18, 38, 45, 49, 50, 46, 46, 31, 37, 81, 89, 90, 89, 84, 87, 84, 40, 104, 111, 124, 114, 112, 116, 108, 50,
        134, 134, 140, 142, 142, 137, 131, 105, 170, 161, 180, 163, 154, 163, 186, 204, 189, 165, 165, 182, 206, 197,
        185, 222, 228, 243, 228, 255, 224, 168, 273, 263, 269, 249, 249, 247, 288, 296, 276, 279, 276, 292, 286, 286,
        283, 311, 311, 304, 306, 282, 326, 334, 334, 318, 359, 335, 354, 275, 347, 357, 354, 382, 382, 393, 311, 303,
        398, 382, 393, 397, 397, 396, 410, 391, 415, 393, 422, 422, 446, 422, 416, 432, 438, 424, 454, 487, 461, 499,
        467, 485, 485, 473, 488, 487, 495, 481, 571, 480, 555, 529, 506, 491, 556, 491, 555, 508, 508, 464, 476, 507,
        484, 484, 514, 512, 576, 517, 526, 574, 574, 554, 559, 547, 566, 566, 558, 579, 575, 556, 583, 628, 628, 548,
        636, 512, 601, 584, 612, 616, 616, 608, 608, 608, 608, 588, 666, 572, 533, 668, 629, 673, 564, 631, 607, 613,
        666, 584, 628, 591, 623, 543, 543, 621, 621, 579, 656, 588, 687, 596, 568, 634, 568, 521, 604, 553, 592, 585,
        568, 594]
for k in range(0, len(cpu0)):
    cpu0[k] = cpu0[k] / 10
[A, x, b] = numpy.polyfit(time0, cpu0, deg=2)
c = numpy.arange(0, 1495)
y = A * (c ** 2) + c * x + b
plt.plot(c, y, label="Fitted")
x0 = numpy.linspace(time0[0], time0[-1], 40000)
times = numpy.array(time0)
cpus = numpy.array(cpu0)
model = make_interp_spline(times, cpus)
y0 = model(x0)
plt.plot(x0, y0, '-.', label="Collected", linewidth=1)
plt.rcParams.update({'font.size': 14})
plt.legend(loc=2)
plt.tick_params(labelsize=14)
plt.xlabel("Load (QPS)", size=20)
plt.ylabel("CPU Utilization (%)", size=20)
plt.tick_params(labelsize=14)
plt.savefig('3A.png', dpi=100, bbox_inches='tight')
plt.show()